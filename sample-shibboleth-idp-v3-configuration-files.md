# Sample Shibboleth IdP v3 configuration files
These examples are the minimally viable samples to work with Azure AD Single Sign-on. Your Shibboleth IdP configurations may have additional elements.

## attribute-resolver.xml sample
```
<?xml version="1.0" encoding="UTF-8"?> 
<AttributeResolver         xmlns="urn:mace:shibboleth:2.0:resolver"          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"          xsi:schemaLocation="urn:mace:shibboleth:2.0:resolver http://shibboleth.net/schema/idp/shibboleth-attribute-resolver.xsd">      <!-- ========================================== -->     <!--      Attribute Definitions                 -->     <!-- ========================================== -->      <!-- Use AD LDS objectGUID for ImmutableID -->     <AttributeDefinition id="ImmutableID" xsi:type="Simple" sourceAttributeID="objectGUID">        <Dependency ref="myLDAP" />     </AttributeDefinition>       <!-- mail for Azure AD User ID -->     <AttributeDefinition id="UserId" xsi:type="Simple" sourceAttributeID="userPrincipalName">        <Dependency ref="myLDAP" />        <AttributeEncoder xsi:type="SAML2String" name="IDPEmail" friendlyName="UserId" />     </AttributeDefinition>      <!-- ========================================== -->     <!--      Data Connectors                       -->     <!-- ========================================== -->      <DataConnector id="myLDAP" xsi:type="LDAPDirectory"         ldapURL="%{idp.attribute.resolver.LDAP.ldapURL}"         baseDN="%{idp.attribute.resolver.LDAP.baseDN}"          principal="%{idp.attribute.resolver.LDAP.bindDN}"         principalCredential="%{idp.attribute.resolver.LDAP.bindDNCredential}"         useStartTLS="%{idp.attribute.resolver.LDAP.useStartTLS:true}"         connectTimeout="%{idp.attribute.resolver.LDAP.connectTimeout}"         responseTimeout="%{idp.attribute.resolver.LDAP.responseTimeout}">         <FilterTemplate>             <![CDATA[                 %{idp.attribute.resolver.LDAP.searchFilter}             ]]>         </FilterTemplate> 	<LDAPProperty name="java.naming.ldap.attributes.binary" value="objectGUID" /> 	<ConnectionPool             minPoolSize="%{idp.pool.LDAP.minSize:3}"             maxPoolSize="%{idp.pool.LDAP.maxSize:10}"             blockWaitTime="%{idp.pool.LDAP.blockWaitTime:PT3S}"             validatePeriodically="%{idp.pool.LDAP.validatePeriodically:true}"             validateTimerPeriod="%{idp.pool.LDAP.validatePeriod:PT5M}"             expirationTime="%{idp.pool.LDAP.idleTime:PT10M}"             failFastInitialize="%{idp.pool.LDAP.failFastInitialize:false}" />     </DataConnector>  </AttributeResolver> 
```

## attribute-filter.xml sample
```
<?xml version="1.0" encoding="UTF-8"?> <AttributeFilterPolicyGroup id="ShibbolethFilterPolicy"         xmlns="urn:mace:shibboleth:2.0:afp"         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"         xsi:schemaLocation="urn:mace:shibboleth:2.0:afp http://shibboleth.net/schema/idp/shibboleth-afp.xsd">      <AttributeFilterPolicy id="PolicyForWindowsAzureAD">        <PolicyRequirementRule xsi:type="Requester" value="urn:federation:MicrosoftOnline" />         <!-- Release mail as Azure AD User ID -->        <AttributeRule attributeID="UserId">          <PermitValueRule xsi:type="ANY" />        </AttributeRule>         <!-- Release Immutable ID to Azure AD -->        <AttributeRule attributeID="ImmutableID">          <PermitValueRule xsi:type="ANY" />        </AttributeRule>          </AttributeFilterPolicy>  </AttributeFilterPolicyGroup> 
```

## metadata-provider.xml sample
```
<?xml version="1.0" encoding="UTF-8"?> <!-- This file is an EXAMPLE metadata configuration file. --> <MetadataProvider id="ShibbolethMetadata" xsi:type="ChainingMetadataProvider"     xmlns="urn:mace:shibboleth:2.0:metadata"     xmlns:resource="urn:mace:shibboleth:2.0:resource"     xmlns:security="urn:mace:shibboleth:2.0:security"     xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata"     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"     xsi:schemaLocation="urn:mace:shibboleth:2.0:metadata http://shibboleth.net/schema/idp/shibboleth-metadata.xsd                         urn:mace:shibboleth:2.0:resource http://shibboleth.net/schema/idp/shibboleth-resource.xsd                          urn:mace:shibboleth:2.0:security http://shibboleth.net/schema/idp/shibboleth-security.xsd                         urn:oasis:names:tc:SAML:2.0:metadata http://docs.oasis-open.org/security/saml/v2.0/saml-schema-metadata-2.0.xsd">                              <MetadataProvider id="AAD" xsi:type="FileBackedHTTPMetadataProvider"              metadataURL="https://nexus.microsoftonline-p.com/federationmetadata/saml20/federationmetadata.xml"               backingFile="C:\Program Files (x86)\Shibboleth\IdP\metadata\AAD-FederationMetadata.xml" />      </MetadataProvider> 
```

relying-party.xml sample
```
<?xml version="1.0" encoding="UTF-8"?> <beans xmlns="http://www.springframework.org/schema/beans"        xmlns:context="http://www.springframework.org/schema/context"        xmlns:util="http://www.springframework.org/schema/util"        xmlns:p="http://www.springframework.org/schema/p"        xmlns:c="http://www.springframework.org/schema/c"        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"                                    default-init-method="initialize"        default-destroy-method="destroy">      <bean id="shibboleth.UnverifiedRelyingParty" parent="RelyingParty">         <property name="profileConfigurations">             <list>             <!-- <bean parent="SAML2.SSO" p:encryptAssertions="false" /> -->             </list>         </property>     </bean>      <bean id="shibboleth.DefaultRelyingParty" parent="RelyingParty">         <property name="profileConfigurations">             <list>                 <bean parent="Shibboleth.SSO" p:postAuthenticationFlows="attribute-release" />                 <ref bean="SAML1.AttributeQuery" />                 <ref bean="SAML1.ArtifactResolution" />                 <bean parent="SAML2.SSO" p:postAuthenticationFlows="attribute-release" />                 <ref bean="SAML2.ECP" />                 <ref bean="SAML2.Logout" />                 <ref bean="SAML2.AttributeQuery" />                 <ref bean="SAML2.ArtifactResolution" />                 <ref bean="Liberty.SSOS" />             </list>         </property>     </bean>      <util:list id="shibboleth.RelyingPartyOverrides">         <!-- Microsoft Azure AD -->         <bean parent="RelyingPartyByName" c:relyingPartyIds="urn:federation:MicrosoftOnline">             <property name="profileConfigurations">                 <list>                     <bean parent="SAML2.SSO"  			p:encryptAssertions="false"                         /> 		    <bean parent="SAML2.Logout" />                 </list>             </property>         </bean>     </util:list>  </beans>
```

saml-nameid.xml sample
```
<?xml version="1.0" encoding="UTF-8"?> <beans xmlns="http://www.springframework.org/schema/beans"        xmlns:context="http://www.springframework.org/schema/context"        xmlns:util="http://www.springframework.org/schema/util"        xmlns:p="http://www.springframework.org/schema/p"        xmlns:c="http://www.springframework.org/schema/c"        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd                            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd"                                    default-init-method="initialize"        default-destroy-method="destroy">      <!-- ========================= SAML NameID Generation ========================= -->       <!-- SAML 2 NameID Generation -->     <util:list id="shibboleth.SAML2NameIDGenerators">              <ref bean="shibboleth.SAML2TransientGenerator" />                  <!-- Uncommenting this bean requires configuration in saml-nameid.properties. -->         <!--         <ref bean="shibboleth.SAML2PersistentGenerator" />         -->         <!-- Persistent ID Generator for all entities except Azure AD --> 	<!--         <bean parent="shibboleth.SAML2PersistentGenerator">             <property name="activationCondition">                 <bean parent="shibboleth.Conditions.NOT">                     <constructor-arg>                         <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="urn:federation:MicrosoftOnline" />                     </constructor-arg>                 </bean>             </property>         </bean>  	-->         <!-- Custom persistent ID Generator for Azure AD -->         <bean parent="shibboleth.SAML2AttributeSourcedGenerator"               p:format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"               p:attributeSourceIds="#{ {'ImmutableID'} }">             <property name="activationCondition">                 <bean parent="shibboleth.Conditions.RelyingPartyId" c:candidates="urn:federation:MicrosoftOnline" />             </property>         </bean>          <!--         <bean parent="shibboleth.SAML2AttributeSourcedGenerator"             p:format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"             p:attributeSourceIds="#{ {'mail'} }" />         -->                      </util:list>      <!-- SAML 1 NameIdentifier Generation -->     <util:list id="shibboleth.SAML1NameIdentifierGenerators">          <ref bean="shibboleth.SAML1TransientGenerator" />          <!--         <bean parent="shibboleth.SAML1AttributeSourcedGenerator"             p:format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"             p:attributeSourceIds="#{ {'mail'} }" />         -->                      </util:list>      </beans>
```
